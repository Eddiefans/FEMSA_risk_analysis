---
title: "Entrega 5"
output: html_document
date: "2024-04-23"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Entrega 5

## Introducción 

El Value at Risk representa la pérdida máxima esperada en un periodo de tiempo. Para calcularlo, exiten distintos métodos que serñan expuestos y explicados en este entregable.
A lo largo del proyecto, se trabajará con el activo de refrencia de este proyecto (FEMSA) y se agregará un segundo activo perteniciente a la Bolsa Mexicana de Valores con la finalidad de armar un portafolio y trabajar sobre él. 
Se calculará el VaR con la metodología paramétrica y no paramétrica para 4 distintos periodos de tiempo y con distintos niveles de confianza y se aplicará una prueba para determinar si el valor obtenido se encuentra subestiamdo, sobreestimado o correcto. 
También se presentará una gráfica para visualizar los rendimientos obtenidos y se propondrá un portafolio óptimo, explicando su composición. 

## Construcción del portafolio
Para fines de esta entrega, se trabajará con un portafolio conformado únicamente de 2 acciones: FEMSA, al ser el activo principal del proyecto completo, y CEMEX, al ser una acción que también cotiza en la BMV. En este caso, el portafolio estará conformado por 200 acciones, divididas en partes iguales entre ambos activos. 
```{r}
library(PerformanceAnalytics)
library(quantmod)
library(tidyverse)
clave1 <- "FEMSAUBD.MX"
clave2 <- "CEMEXCPO.MX"
datos <- new.env()
getSymbols(c(clave1, clave2), from="2023-10-29",to = "2024-04-25", env=datos)
p1 <-datos[[clave1]][,6]
p2 <-datos[[clave2]][,6]
precios <- na.omit(merge.xts(p1,p2))
```

Para poder realizar los cálculos necesarios posteriores, se calcula el valor inicial del portafolio. 
```{r}
v0<-as.numeric(100*last(precios[,1]) + 100*last(precios[,2]))
v0
```

Tomando como apoyo la fórmula, se calcula la volatilidad del portafolio. 
$$\sigma=\sqrt{wCw^T}$$

```{r}
w <- c(100*as.numeric(last(precios[,1]))/v0,100*as.numeric(last(precios[,2]))/v0)
w
```
```{r}
rend <- na.omit(diff(log(precios)))
C <- cov(rend)
C
```
Se calcula la volatilidad
```{r}
sigma <- sqrt(w%*%C%*%w)
sigma
```
```{r}
z90 <- qnorm(.1)
z95 <- qnorm(.05)
z99 <- qnorm(.01)
```
## VaR paramétrico
1,5,10 and 20 days
In the case of parametric estimation, you must use the value of the average daily volatility of the last six months and the value of “So”, will be the one to which the methodology is applied in class.

Apoyados de los valores de z correspondientes, se calcula el VaR en las distintas temporalidades que se solicitan. 

VaR a un día con 90% ,95% y 99% de confianza
```{r}
VaR90 <- sigma*v0*z90
VaR95 <- sigma*v0*z95
VaR99 <- sigma*v0*z99
VaR90
VaR95
VaR99
```
5 días 
```{r}
VaR90_5 <- sigma*v0*z90*sqrt(5)
VaR95_5 <- sigma*v0*z95*sqrt(5)
VaR99_5 <- sigma*v0*z99*sqrt(5)
VaR90_5
VaR95_5
VaR99_5
```
10 días 
```{r}
VaR90_10 <- sigma*v0*z90*sqrt(10)
VaR95_10 <- sigma*v0*z95*sqrt(10)
VaR99_10 <- sigma*v0*z99*sqrt(10)
VaR90_10
VaR95_10
VaR99_10
```
20 días 
```{r}
VaR90_5 <- sigma*v0*z90*sqrt(20)
VaR95_5 <- sigma*v0*z95*sqrt(20)
VaR99_5 <- sigma*v0*z99*sqrt(20)
VaR90_5
VaR95_5
VaR99_5
```
### Back testing
Do the Back testing for one day VaR with both methodology 

## VaR no paramétrico
1,5,10 and 20 days.
In the case of the non-parametric methodology, the student must use historical simulation (with all possible data and the So value of the day the methodology is applied in class).

### Gráfica
At the case of non-parametric estimation, the corresponding graph must be presented where the one-day VaR can be seen at the three estimated confidence levels 

### Back testing
Do the Back testing for one day VaR with both methodology 

## Composición óptima del portafolio
Find the optimal composition of the portfolio that minimizes the Value at Risk.